<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="door">
	<select id="selectDoorDetail"  parameterType="HashMap" resultType="HashMap">
		  SELECT TD.id
		       , TD.door_nm
		       , TD.building_id
		       , TD.area_id
		       , TD.floor_id
		       , TD.alarm_typ
		       , TDS.id as sch_id
		       , TDS.door_sch_nm as sch_nm
		       , (select GROUP_CONCAT( TT.id  SEPARATOR '/ ') from T_TERMINAL TT where TT.door_id= TD.id ) AS terminal_id
		       , (select GROUP_CONCAT( TT.terminal_cd  SEPARATOR '/ ') from T_TERMINAL TT where TT.door_id= TD.id ) AS terminal_cd
		       , (select GROUP_CONCAT( TT.mgmt_num  SEPARATOR '/ ')  from T_TERMINAL TT where TT.door_id= TD.id ) AS mgmt_num
		    FROM T_DOOR TD
 LEFT OUTER JOIN T_DOORGRP_DOOR TDD ON TD.id = TDD.door_id
 LEFT OUTER JOIN T_DOORGRP TDG      ON TDD.doorgrp_id = TDG.id
 LEFT OUTER JOIN T_DOOR_SCH TDS     ON TDD.doorgrp_id = TDS.id
		   WHERE TD.id = #{id}
		<if test='@aero.cubox.util.CommonUtils@notEmpty(id)'>
			 AND TD.id = #{id}
		</if>
	</select>

	<select id="selectDoorList" parameterType="HashMap" resultType="HashMap">
		SELECT id,
			   building_id,
			   area_id,
			   floor_id,
			   door_nm,
			   alarm_typ,
			   created_at,
			   updated_at
		FROM T_DOOR TD
		WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(building_id)'>
		  AND TD.building_id = #{building_id}
		</if>
		<if test='@aero.cubox.util.CommonUtils@notEmpty(area_id)'>
		  AND TD.area_id = #{area_id}
		</if>
		<if test='@aero.cubox.util.CommonUtils@notEmpty(floor_id)'>
		  AND TD.floor_id = #{floor_id}
		</if>
	</select>


	<insert id="insertDoor" parameterType="HashMap" useGeneratedKeys="true" keyProperty="doorId" keyColumn="id">
		insert
		into
			T_DOOR ( building_id
				   , area_id
				   , floor_id
				   , door_nm
				   , alarm_typ
				   , created_at
		)
		values  ( #{buildingId}
				, #{areaId}
				, #{floorId}
				, #{doorNm}
				, #{alarmGroupId}
				, NOW()
				)

	</insert>

	<update id="updateDoor" parameterType="HashMap">
		UPDATE T_DOOR
		   SET building_id = #{buildingId}
		     , area_id = #{areaId}
		     , floor_id = #{floorId}
		     , door_nm = #{doorNm}
		     , alarm_typ = #{alarmGroupId}
		     , updated_at = NOW()
		 WHERE id = #{id}
	</update>


	<delete id="deleteDoor" parameterType="HashMap" >
		DELETE
		  FROM T_DOOR
		 WHERE id = #{id}

	</delete>


	<select id="selectBuildingList" parameterType="HashMap" resultType="HashMap">
		SELECT id,
		       workplace_id,
		       building_nm,
		       created_at,
		       updated_at
		  FROM T_BUILDING TB
		 WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(workplace_id)'>
		  AND TB.workplace_id = #{workplace_id}
		</if>
	</select>


	<select id="selectFloorList" parameterType="HashMap" resultType="HashMap">
		SELECT id,
		       building_id,
		       area_id,
		       floor_nm,
		       created_at,
		       updated_at
		  FROM T_FLOOR TF
		 WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(areaId)'>
		  AND TF.area_id = #{areaId}
		  AND TF.building_id = #{buildingId}
		</if>
	</select>


	<select id="selectAreaList" parameterType="HashMap" resultType="HashMap">
		SELECT id,
		       building_id,
		       area_nm,
		       created_at,
		       updated_at
		  FROM T_AREA TA
		 WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(buildingId)'>
		   AND TA.building_id = #{buildingId}
		</if>
	</select>


	<select id="selectWorkplaceList" parameterType="HashMap" resultType="HashMap">
		SELECT id,
               workplace_nm,
		       created_at,
		       updated_at
		  FROM T_WORKPLACE TW
		 WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(id)'>
		   AND TW.id = #{id}
		</if>
	</select>

	<select id="selectDoorGroupList"  parameterType="HashMap" resultType="HashMap">
		SELECT TD.id
		     , TD.nm
		     , TD.door_sch_id
		     , TDS.door_sch_nm
		  FROM T_DOORGRP TD
		     , T_DOOR_SCH TDS
		 WHERE TD.door_sch_id = TDS.id
		<if test='@aero.cubox.util.CommonUtils@notEmpty(id)'>
		   AND TD.id = #{id}
		</if>
		<if test='@aero.cubox.util.CommonUtils@notEmpty(keyword)'>
			AND TD.nm like CONCAT('%',#{keyword},'%')
		</if>
	</select>


	<select id="selectDoorGroupDetail"   parameterType="HashMap" resultType="HashMap">
		SELECT TD.id
			 , TD.nm
			 , TD.door_sch_id
			 , TDS.door_sch_nm
		  FROM T_DOORGRP TD
			 , T_DOOR_SCH TDS
		 WHERE TD.door_sch_id = TDS.id
	</select>



	<insert id="insertDoorGroup" parameterType="HashMap">
		INSERT
		  INTO T_DOORGRP
		     ( id
		     , nm
		     , door_sch_id)
	    VALUES
	         ( #{id}
			 , #{nm}
			 , #{doorSchId}
			 )
	</insert>


	<update id="updateDoorGroup" parameterType="HashMap">
		UPDATE T_DOORGRP
		   SET nm = #{nm}
		     , door_sch_id = #{doorSchId}
		 WHERE id = #{id}
	</update>


	<delete id="deleteDoorGroup" parameterType="HashMap" >
		DELETE
		  FROM T_DOORGRP
		 WHERE id = #{id}

	</delete>


	<select id="selectDoorSchList"  parameterType="HashMap" resultType="HashMap">
		SELECT id,
		       door_sch_nm,
		       created_at,
		       updated_at
		  FROM T_DOOR_SCH TDS
		 WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(id)'>
		   AND TDS.id = #{id}
		</if>

		<if test='@aero.cubox.util.CommonUtils@notEmpty(keyword)'>
			AND TDS.door_sch_nm like CONCAT('%',#{keyword},'%')
		</if>
	</select>


	<select id="selectScheduleDetail"  parameterType="HashMap" resultType="HashMap">
		SELECT id,
			   door_sch_nm,
			   created_at,
			   updated_at
		  FROM T_DOOR_SCH TDS
		 WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(id)'>
		   AND TDS.id = #{id}
		</if>
	</select>


	<insert id="insertSchedule" parameterType="HashMap">
		INSERT
		  INTO T_DOOR_SCH
		     ( id,
			   door_sch_nm,
			   created_at,
			   updated_at
		     )
		VALUES
		     ( #{id}
			 , #{doorSchNm}
		     , NOW()
			 , NOW()
			 )
	</insert>


	<update id="updateSchedule" parameterType="HashMap">
		UPDATE T_DOOR_SCH
		   SET door_sch_nm = #{doorSchNm}
		     , updated_at= NOW()
		 WHERE id = #{id}
	</update>


	<delete id="deleteSchedule" parameterType="HashMap" >
		DELETE
		  FROM T_DOOR_SCH
		 WHERE id = #{id}
	</delete>



	<select id="selectScheduleByDayDetail"  parameterType="HashMap" resultType="HashMap">
		SELECT id,
		       door_sch_id,
		       weekday,
		       beg_tm,
		       end_tm,
		       created_at,
		       updated_at
		  FROM T_DOOR_SCH_WEEKDAY TDSW
		 WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(id)'>
		   AND TDSW.id = #{id}
		</if>
	</select>


	<insert id="insertScheduleByDay" parameterType="HashMap">
		INSERT
		  INTO T_DOOR_SCH_WEEKDAY
		     ( id,
			   door_sch_id,
			   weekday,
			   beg_tm,
			   end_tm,
			   created_at,
			   updated_at
		     )
		VALUES
		     ( #{id}
			 , #{doorSchId}
			 , #{weekday}
			 , #{begTm}
			 , #{endTm}
			 , NOW()
			 , NOW()
			 )
	</insert>


	<update id="updateScheduleByDay" parameterType="HashMap">
		UPDATE T_DOOR_SCH_WEEKDAY
		   SET door_sch_id = #{doorSchId}
		     , weekday= #{weekday}
		     , beg_tm= #{begTm}
		     , end_tm= #{endTm}
		     , updated_at= NOW()
		 WHERE id = #{id}
	</update>


	<delete id="deleteScheduleByDay" parameterType="HashMap" >
		DELETE
		  FROM T_DOOR_SCH_WEEKDAY
		 WHERE id = #{id}

	</delete>


	<select id="selectTerminalDetail" parameterType="HashMap" resultType="HashMap">
		SELECT id,
			   terminal_cd,
			   terminal_typ,
			   door_id,
			   mgmt_num,
			   ip_addr,
			   complex_auth_typ,
			   face_auth_typ,
			   created_at,
			   updated_at
		  FROM T_TERMINAL TT
		 WHERE 1 = 1
	</select>


	<select id="selectTerminalList"  parameterType="HashMap" resultType="HashMap">
		SELECT TM.id as id,
		       TD.door_nm as doorNm,
		       TM.mgmt_num as mgmtNum,
		       TM.terminal_cd as terminalCd,
		       TM.terminal_typ as terminalTyp,
		       (SELECT cd_nm
		          FROM T_CMMN_CD
                 WHERE cd_typ = 'TerminalTyp'
                   AND cd = TM.terminal_typ) AS terminalTypNm,
               TM.ip_addr as ipAddr,
               TM.complex_auth_typ as complexAuthTyp,
               (SELECT cd_nm
                  FROM T_CMMN_CD
                 WHERE cd_typ = 'ComplexAuthTyp'
                   AND cd = TM.complex_auth_typ) AS complexAuthTypNm,
               TM.face_auth_typ as faceAuthTyp,
               (SELECT cd_nm
                  FROM T_CMMN_CD
                 WHERE cd_typ = 'FaceAuthTyp'
                   AND cd = TM.face_auth_typ) AS faceAuthTypNm,
               TM.use_yn as useYn
           FROM T_TERMINAL TM
LEFT OUTER JOIN	T_DOOR TD ON TM.door_id = TD.id
		  WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(registrationionStatus)'>
			<if test='registrationionStatus.equals("N")'>
			AND (TM.door_id is null or TM.door_id ='')
			</if>
		</if>
		<if test='@aero.cubox.util.CommonUtils@notEmpty(keyword)'>
			AND (TM.model_nm like CONCAT('%',#{keyword},'%') OR TM.terminal_cd like CONCAT('%',#{keyword},'%') OR TM.mgmt_num like CONCAT('%',#{keyword},'%'))
		</if>

	</select>

	<select id="selectDoorAlarmGrpList"  parameterType="HashMap" resultType="HashMap">
		SELECT TDG.id
		     , TDG.nm
		     , TDG.time
		     , TDG.created_at
		  FROM T_DOORALARM_GRP TDG
		 WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(id)'>
		   AND TDG.id = #{id}
		</if>
		<if test='@aero.cubox.util.CommonUtils@notEmpty(keyword)'>
			AND TDG.nm like CONCAT('%',#{keyword},'%')
		</if>
	</select>


	<select id="selectDoorAlarmGrpDetail"  parameterType="HashMap" resultType="HashMap">
		SELECT TDG.id,
		       TDG.nm,
		       TDG.time,
		       TDG.updated_at
		  FROM T_DOORALARM_GRP TDG
		 WHERE 1=1
		<if test='@aero.cubox.util.CommonUtils@notEmpty(id)'>
		   AND TDG.id = #{id}
		</if>
	</select>


	<insert id="insertDoorAlarmGrp" parameterType="HashMap">
	  INSERT
		INTO T_DOORALARM_GRP
		   ( id
		   , nm
		   , time
           , created_at
           , updated_at
		   )
	  VALUES
	       ( #{id}
		   , #{nm}
		   , #{time}
		   , NOW()
		   , NOW()
		   )

	</insert>


	<update id="updateDoorAlarmGrp" parameterType="HashMap">
		UPDATE T_DOORALARM_GRP
		   SET nm = #{id}
		     , time = #{time}
		     , updated_at= NOW()
		 WHERE id = #{id}
	</update>


	<delete id="deleteDoorAlarmGrp" parameterType="HashMap" >
		DELETE
		  FROM T_DOORALARM_GRP
		 WHERE id = #{id}

	</delete>


	<update id="updateDoorIdForTerminal" parameterType="HashMap">
		UPDATE T_TERMINAL
		   SET door_id = #{doorId}
		     , updated_at= NOW()
		 WHERE id = #{id}
	</update>

</mapper>